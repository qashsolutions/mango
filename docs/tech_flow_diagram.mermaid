flowchart TD
    %% Client Layer
    iOS[iOS 18 App - SwiftUI] --> Auth[Firebase Auth + Google Sign-In]
    iOS --> Speech[Apple Speech Framework]
    iOS --> Contacts[iOS Contacts Framework]
    iOS --> Health[iOS HealthKit - Optional]
    iOS --> Notifications[iOS UserNotifications + UNNotificationCenter]
    
    %% Authentication & User Management
    Auth --> FirebaseDB[(Firebase Firestore)]
    Auth --> UserProfile[User Profile Management]
    
    %% Data Storage Layer
    FirebaseDB --> UserData[User Medication Data]
    FirebaseDB --> CaregiverData[Caregiver Access Control]
    FirebaseDB --> DoctorData[Doctor Information]
    FirebaseDB --> ConflictHistory[Conflict Query History]
    
    %% Voice & Input Processing
    Speech --> SpeechToText[Apple Intelligence - Speech Recognition]
    SpeechToText --> TextProcessing[Text Validation & Autocomplete]
    TextProcessing --> CoreData[iOS Core Data - Local Cache]
    
    %% AI & Conflict Detection
    TextProcessing --> MedgemmaAPI[Medgemma 27B API - Vertex AI]
    MedgemmaAPI --> ConflictEngine[Drug Interaction Analysis]
    ConflictEngine --> AlertSystem[Conflict Alert Generation]
    
    %% Notification System
    AlertSystem --> APNs[Apple Push Notification Service]
    APNs --> UserDevice[User iOS Device]
    APNs --> CaregiverDevice[Caregiver iOS Device]
    
    %% Payment Processing
    iOS --> ApplePay[Apple Pay Framework]
    iOS --> StripeSDK[Stripe iOS SDK]
    ApplePay --> PaymentAPI[Payment Processing API]
    StripeSDK --> PaymentAPI
    PaymentAPI --> SubscriptionMgmt[Subscription Management - Firebase]
    
    %% Live Activities & Shortcuts
    iOS --> LiveActivities[iOS Live Activities Framework]
    iOS --> SiriKit[SiriKit Framework]
    iOS --> Shortcuts[iOS Shortcuts App Integration]
    
    %% Data Sync & Backup
    CoreData --> CloudSync[iCloud Core Data Sync - Optional]
    FirebaseDB --> DataExport[Local Device Export - JSON/CSV]
    
    %% Security Layer
    FirebaseDB --> Security[Firebase Security Rules]
    MedgemmaAPI --> APIKey[Vertex AI API Authentication]
    CaregiverData --> QRGeneration[QR Code Generation - CryptoKit]
    
    %% UI Components & Design
    iOS --> SVGIcons[SVG Icon System]
    iOS --> DynamicType[iOS Dynamic Type]
    iOS --> Accessibility[iOS Accessibility Framework]
    iOS --> DarkMode[iOS Appearance Framework]
    
    %% Third-Party Integrations
    ConflictEngine --> DrugDatabase[Medical Drug Database API]
    TextProcessing --> AutoComplete[Medication Name Database]
    
    %% Analytics & Monitoring
    iOS --> Analytics[Firebase Analytics]
    MedgemmaAPI --> Monitoring[Vertex AI Monitoring]
    iOS --> Crashlytics[Firebase Crashlytics]
    
    %% Styling
    classDef iosLayer fill:#007AFF,color:#fff
    classDef firebaseLayer fill:#FFA000,color:#fff
    classDef aiLayer fill:#4CAF50,color:#fff
    classDef securityLayer fill:#F44336,color:#fff
    classDef uiLayer fill:#9C27B0,color:#fff
    
    class iOS,Speech,Contacts,Notifications,LiveActivities,SiriKit iosLayer
    class FirebaseDB,Auth,Analytics,Crashlytics,SubscriptionMgmt firebaseLayer
    class MedgemmaAPI,ConflictEngine,DrugDatabase,AutoComplete aiLayer
    class Security,APIKey,QRGeneration securityLayer
    class SVGIcons,DynamicType,Accessibility,DarkMode uiLayer